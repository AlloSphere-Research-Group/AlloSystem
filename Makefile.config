#=========================================================================
# AlloCore main makefile configuration
#=========================================================================
#=========================================================================
# Uncomment your system -or- use command-line argument PLATFORM='platform'
#=========================================================================
PLATFORM	= macosx
#PLATFORM	= linux
#PLATFORM	= windows

BIG_ENDIAN	= 0
BUILD_CONFIG	= release

AUDIO_BINDING	= PortAudio
WINDOW_BINDING	= GLUT
AUTORUN_TESTS	= 1
STRICT_WARNINGS = 1

#=========================================================================
# Customize to fit your system
#=========================================================================
PREFIX     = /usr/local
CONFPREFIX = $(PREFIX)/etc
MANPREFIX  = $(PREFIX)/share/man

LIBS       = -L$(PREFIX)/lib -L/usr/lib

CFLAGS     = -I. -I$(PREFIX)/include -I/usr/include \
             -I./include -I../include -I../../include \
	     -I./unitTests \
             -Wall \
             -D__STDC_CONSTANT_MACROS

LFLAGS     = $(LIBS) -lm -lstdc++

DLIBFLAGS := -Wl,-single_module -compatibility_version 1 \
             -current_version 1

#-------------------------------------------------------------------------
# Default variables
#-------------------------------------------------------------------------
AR		= ar cr
CC		= g++
INSTALL		= install
RANLIB		= ranlib
LIB_NAME	= allocore
SLIB_EXT	= a

BUILD_DIR	= build
IO_DIR		= io
PRO_DIR		= protocol
SYS_DIR		= system
TYPES_DIR	= types
TEST_DIR	= unitTests

# These are defined according to platform
DLIB_EXT	=
DLIB_OPT	=
DEV_DIR		=

#=========================================================================
# DO NOT EDIT BELOW!
#=========================================================================

#-------------------------------------------------------------------------
# Platform specific section
#-------------------------------------------------------------------------
# Linux:
ifeq ($(PLATFORM), linux)
	LFLAGS  += -lrt
	CFLAGS  += -D__LINUX__
	DLIB_EXT = so
	DLIB_OPT = shared
endif

# Mac OS X:
ifeq ($(PLATFORM), macosx)
	LFLAGS	+= -framework Carbon
	DLIB_EXT = dylib
	DLIB_OPT = dynamiclib
	DEV_DIR = dev_osx
endif

# Windows
ifeq ($(PLATFORM), windows)
endif


#-------------------------------------------------------------------------
# Finalize compilation flags
#-------------------------------------------------------------------------
ifeq ($(BUILD_CONFIG), release)
	CFLAGS += -O3 -fpeel-loops
else
endif

CFLAGS += -I/$(DEV_DIR)

ifneq ($(STRICT_WARNINGS), 0)
	CFLAGS += \
		-Wreturn-type -Wnon-virtual-dtor -Woverloaded-virtual \
		-Wformat -Wmissing-braces -Wparentheses -Wswitch \
		-Wunused-variable -Wsign-compare -Wnewline-eof
endif

#-------------------------------------------------------------------------
# Define dependent variables
#-------------------------------------------------------------------------
SLIB_FILE	= lib$(LIB_NAME).$(SLIB_EXT)
DLIB_FILE	= lib$(LIB_NAME).$(DLIB_EXT)
BIN_DIR		= $(BUILD_DIR)/$(BUILD_CONFIG)
OBJ_DIR		= $(BIN_DIR)/obj
VPATH		= $(addsuffix /src, $(IO_DIR) $(PRO_DIR) $(SYS_DIR) $(TYPES_DIR))

# dummy target to force rebuilds
.FORCE:


# This will soon go away...
TEST_EXEC = ../$(BUILD_DIR)/$(*F)
ifeq ($(AUTORUN_TESTS), 1)
	RUN_TEST = $(TEST_EXEC)
else
	RUN_TEST = 
endif

# Was being used like this...
#	@$(CC) $(CFLAGS) src/al_Serialize.c src/al_Serialize.cpp $@ -o $(TEST_EXEC) $(LFLAGS)
#	@$(RUN_TEST)


